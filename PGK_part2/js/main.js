function Ctrl(){function e(e,t){t.addClass("disabled");var s=0,a=0,n="",i=!0,o=0,r=0;t.each(function(e,t){"true"===$(t).attr("right")&&r++,$(t).hasClass("selected")&&"true"!==$(t).attr("right")&&(i=!1),$(t).hasClass("selected")&&"true"===$(t).attr("right")&&o++}),i&&o==r&&(y.testScore+=100),y.currentQuest++,y.currentQuest>=y.questionList.length?(y.testScore>0&&(s=Math.floor(y.testScore/y.questionList.length)),n='<p class="big-size"><span>Ваш результат: '+s+"%</span></p>",a=s>=y.successScore?1:-1,a<0?n+="<p>Вам не удалось ответить на вопросы итогового тестирования в достаточном объеме.</p><p>"+s+"%  - это недостаточный результат.</p><p>Может быть, вы были невнимательны или что-то отвлекло вас.</p><p>Для возврата к разделам курса воспользуйтесь кнопкой «МЕНЮ», повторите материалы и попробуйте пройти тестирование еще раз.</p>":(y.success&&(y.learner=pipwerks.SCORM.get("cmi.learner_name")),n+="<p>Поздравляем!</p><p>Вы успешно прошли итоговое тестирование учебного курса «Антикоррупционная политика АО «ПГК».</p>"),y.sendResult(a,s,n)):y.makeTask(e,y.currentQuest)}function t(){clearInterval(w),document.getElementById("main-preloader").style.display="none",document.getElementById("intro").style.display="block"}function s(){$.getJSON("js/courseStructure.json",function(e){y.structure=e,a()}).fail(function(e,t,s){}),$.getJSON("js/test.json",function(e){C=e}).fail(function(e,t,s){})}function a(){A.slider({range:"min",min:0,max:y.structure.pages.length,animate:"slow"}).slider("disable"),j.animate({opacity:0},0),$("#container").tooltip({items:"[jqtitle]",content:function(){return $(this).attr("jqtitle")}}),$("#course-title").find("p").text(y.structure.course),H.on("click",function(){b(y.bookmark+1)}),J.on("click",function(){b(y.bookmark-1)}),$("#menuBtn").on("click",function(){S||(S=!0,M=!0,c("menu"),E.css("display","block").animate({left:"0px"},400))}),$("#statsBtn").on("click",function(){S||(S=!0,B=!0,c("stats"),L.fadeToggle(400))}),$("#helpBtn").on("click",function(){k()}),$("#menuBtn, #statsBtn, #helpBtn").on("click",function(){j.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){g()})})}),$(".closeAssetBtn").on("click",function(){g()}),P.on("click",function(){y.coursePage.restart(),g()}),z.on("click",function(){b(y.bookmark+1)}),$("#exitBtn").on("click",function(){h(),$("#container").empty().append('<div id="end"></div>'),setTimeout(function(){window.close()},2e3)}),i(y.structure.pages),o(y.structure.pages),r(y.structure.pages),b(y.bookmark)}function n(){X+=8,$(".preload-wheel").rotate(X)}function i(e){if(!(U||U.length>0)){U={},U.pages=[];for(var t=0;t<e.length;t++){var s={};s.score=0,0==t?(s.status=1,s.score=100):s.status=0,s.order=t,s.type=e[t].type[0],"ex"!=e[t].type&&"test"!=e[t].type||(s.score=-1),U.pages.push(s)}console.log(U)}}function o(e){y.interactions=[];for(var t=0,s=0;s<e.length;s++)"ex"==e[s].type&&(y.interactions[s]=t,pipwerks.SCORM.set("cmi.interactions."+t+".id",e[s].title),pipwerks.SCORM.set("cmi.interactions."+t+".type","choice"),t++)}function r(e){for(var t='<ul id="menu-list">',s='<ul id="stats-list">',a=0;a<U.pages.length;a++)t+='<li order="'+U.pages[a].order+'" type ="'+U.pages[a].type+'" ',a==y.bookmark&&(t+='class="current"'),t+='><div class="menu-item-status"> </div> <div class="menu-item-num">'+Number(a+1)+".</div><p>"+e[a].title+"</p> </li>","e"==U.pages[a].type&&(s+='<li order="'+U.pages[a].order+'" type ="'+U.pages[a].type+'"> <div class="stats-item-status"> </div> <p>'+e[a].title+"</p> </li>");t+="</ul>",s+="</ul>",$("#menu-body").append(t),$("#stats-exs").append(s),$("#menu-list li, #stats-list li").on("click",function(e){b($(e.target).closest("li").attr("order"))}),$("#stats-progress, #tests-progress").progressbar({max:100})}function c(e){switch(e){case"menu":var t=$("#menu-list").find("li");t.removeClass("current");var s=".menu-item-status";break;case"stats":var t=$("#stats-list").find("li"),s=".stats-item-status",a=l();a.exs.done>0&&$("#stats-msg").text("Упражнений выполнено: "+a.exs.done+" из "+a.exs.num),Q.progressbar("value",a.exs.res),Q.find(".progress-label")[0].innerHTML=Math.floor(a.exs.res)+"%"}for(var n,i=0;i<t.length;i++)n=$(t[i]),i==y.bookmark&&n.addClass("current"),"s"!=n.attr("type")&&"c"!=n.attr("type")||1!=U.pages[Number(n.attr("order"))].status||n.find(s).addClass("visited"),"e"!=n.attr("type")&&"t"!=n.attr("type")||(1==U.pages[Number(n.attr("order"))].status?n.find(s).addClass("complited"):-1==U.pages[Number(n.attr("order"))].status&&n.find(s).addClass("failed"))}function l(){for(var e=0,t=0,s=0,a=0,n=0,i=0,o=0,r=0,c=0,l=0,d=0;d<U.pages.length;d++)"e"==U.pages[d].type&&(U.pages[d].score>0&&(e+=U.pages[d].score),1==U.pages[d].status&&a++,t++),"s"==U.pages[d].type&&(c+=U.pages[d].score,l++),"t"==U.pages[d].type&&(U.pages[d].score>0&&(n+=U.pages[d].score),1==U.pages[d].status&&r++,i++);return c/=l,t>0&&(s=e/t),o=i>0?n/i:(s+c)/2,{exs:{num:t,res:s,done:a},tests:{num:i,res:o,done:r}}}function d(){E.animate({left:-$("#menu").width()},400,function(){$(this).css("display","none")}),M=!1}function p(){L.fadeToggle(400),B=!1}function u(){N.fadeToggle(400),x=!1}function m(){I.fadeToggle(400),T=!1}function g(){M&&d(),B&&p(),x&&u(),T&&m(),j.animate({opacity:0},400,function(){$(this).css("display","none").off()}),S=!1}function f(e,t,s,a){S&&g(),x=!0,S=!0,e>0?(P.css("display","none"),z.css("display","inline-block"),$("#feedback-head p").css({color:"#2B7C00"})):(P.css("display","inline-block"),z.css("display","none"),$("#feedback-head p").css({color:"#7C002F"})),a&&(P.css("display","none"),z.css("display","none")),N.stop().fadeToggle(400).find("#feedback-body").html(s),j.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){g()})})}function k(){S||(S=!0,T=!0,I.fadeToggle(400),j.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){g()})}))}function v(){for(var e=0,t=0;t<U.pages.length&&!(U.pages[t].status<1);t++)e++;A.slider("value",e)}function b(e){function t(){clearInterval(w),F.css("display","none"),0==e&&k()}var e=Number(e);if(!(e<0||e>y.structure.pages.length-1||e>0&&y.strongNavigation&&U.pages[e-1].score<y.pageSuccessScore)){"s"==U.pages[e].type&&(U.pages[e].status=1,U.pages[e].score=100),0==e?(J.addClass("disabled"),H.removeClass("disabled")):e==y.structure.pages.length-1?(H.addClass("disabled").removeAttr("jqtitle"),J.removeClass("disabled")):U.pages[e].score<y.pageSuccessScore?(H.addClass("disabled").attr("jqtitle",K),J.removeClass("disabled")):"t"==U.pages[y.bookmark].type?U.pages[y.bookmark].score>y.SuccessScore&&H.removeClass("disabled").removeAttr("jqtitle"):(H.removeClass("disabled").removeAttr("jqtitle"),J.removeClass("disabled")),S&&g(),q.text(String(e+1)+"/"+String(y.structure.pages.length)),ctrl.coursePage&&ctrl.coursePage.stop();var s=document.getElementById(G);s&&O.removeChild(s),O.innerHTML="",y.bookmark=e,$(R).find("p").text(y.structure.pages[e].title),v(),clearInterval(w),D.stop(!0),w=setInterval(n,50),F.css("display","block");var a=document.createElement("iframe");a.addEventListener?a.addEventListener("load",t,!1):a.attachEvent?a.attachEvent("onload",t):a.onload=t,a.src="pages/"+y.structure.pages[e].location+"/index.html",a.name=G,a.width=a.height="100%",a.frameBorder="0",O.appendChild(a),h()}}function h(){y.success&&(pipwerks.SCORM.set("cmi.location",String(y.bookmark)),pipwerks.SCORM.set("cmi.suspend_data",JSON.stringify(U)),V=l().tests.res,pipwerks.SCORM.set("cmi.score.raw",String(V)),V>=y.successScore?pipwerks.SCORM.set("cmi.completion_status","completed"):pipwerks.SCORM.set("cmi.completion_status","incomplete"),pipwerks.SCORM.save())}var y=this;y.structure,y.bookmark=0,y.successScore=80,y.pageSuccessScore=1,y.strongNavigation=!0,y.learner="Имя обучаемого",y.sendResult=function(e,t,s,a){U.pages[y.bookmark].status=e,U.pages[y.bookmark].score=t,v(),"c"!=U.pages[y.bookmark].type&&("t"!=U.pages[y.bookmark].type&&pipwerks.SCORM.set("cmi.interactions."+y.interactions[y.bookmark]+".result",String(t)),f(e,t,s,a)),"t"==U.pages[y.bookmark].type?U.pages[y.bookmark].score>y.SuccessScore&&H.removeClass("disabled").removeAttr("jqtitle"):U.pages[y.bookmark].score>y.pageSuccessScore&&H.removeClass("disabled").removeAttr("jqtitle"),h()},y.makeMeTestQuestionList=function(){var e=[];e=e.concat(_.shuffle(C.test1.group1),_.sample(C.test1.group2,4),_.sample(C.test1.group3,4),_.sample(C.test1.group4,6),_.sample(C.test1.group5,6)),y.questionList=e,y.currentQuest=0,y.testScore=0},y.makeTask=function(e,t){function s(){var e=y.questionList[t].answers;e=_.shuffle(e);for(var s=0;s<e.length;s++)a.append('<div class="answer" right="'+e[s].right+'">'+e[s].label+'<div class="check-item '+n+'"></div></div>')}var a=$(e).find("#task-body"),n=y.questionList[t].type,i="";switch(a.empty(),a.append('<p id="test-quest-num">'+Number(t+1)+"/"+y.questionList.length+"</p>"),i="single"==n?"Выберите один ответ.":"Выберите один или несколько ответов.",a.append('<p id="test-quest-txt">'+y.questionList[t].question+"<br/><span>"+i+"</span></p>"),n){case"single":n="radio",s(),y.makeTestSingleTask(e);break;case"multi":n="box",s(),y.makeTestMultiTask(e)}},y.makeTestSingleTask=function(t){function s(){n.removeClass("selected"),$(this).addClass("selected");var e=!1;n.each(function(t,s){$(s).hasClass("selected")&&(e=!0)}),e?a.attr("disabled",!1).removeClass("disabled"):a.attr("disabled",!0).addClass("disabled")}var a=$(t).find("#test-answBtn"),n=$(t).find(".answer");a.off("click").on("click",function(){e(t,n)}).addClass("disabled").attr("disabled",!0),n.off("click").on("click",s)},y.makeTestMultiTask=function(t){function s(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected");var e=!1;n.each(function(t,s){$(s).hasClass("selected")&&(e=!0)}),e?a.attr("disabled",!1).removeClass("disabled"):a.attr("disabled",!0).addClass("disabled")}var a=$(t).find("#test-answBtn"),n=$(t).find(".answer");a.off("click").on("click",function(){e(t,n)}).addClass("disabled").attr("disabled",!0),n.off("click").on("click",s)},y.printCert=function(){var e=window.location.origin+window.location.pathname.split("index.html")[0]+"pages/cert/index.html";window.open(e,"printPage","width=1024, height=768")},y.startCourse=function(){if(document.getElementById("intro").style.display="none",document.getElementById("container").style.display="block",pipwerks.SCORM.version="2004",y.success=pipwerks.SCORM.init(),y.success){document.getElementById("hello").innerHTML="";var e=pipwerks.SCORM.get("cmi.completion_status");e&&(W=e),e=pipwerks.SCORM.get("cmi.location"),(e||void 0!=e||"undefinded"!=e||"NaN"!=e)&&(y.bookmark=Number(e)),e=pipwerks.SCORM.get("cmi.suspend_data"),e&&e.length>0&&(U=JSON.parse(e)),e=pipwerks.SCORM.get("cmi.score.raw"),e&&e.length>0&&(V=e),V>=y.successScore&&(y.learner=pipwerks.SCORM.get("cmi.learner_name"))}else document.getElementById("hello").innerHTML="No LMS detected.";s()};var C,w,S=!1,M=!1,B=!1,x=!1,T=!1,O=document.getElementById("page-container"),R=document.getElementById("page-title"),q=$(".paginator"),E=$("#menu"),L=$("#stats"),N=$("#feedback"),I=$("#help"),j=$("#dark"),A=$("#progress-bar"),Q=$("#stats-progress"),H=($("#tests-progress"),$(".nextBtn")),J=$(".prevBtn"),P=$("#againBtn"),z=$("#continueBtn"),F=$("#page-preloader"),D=$(".preload-wheel"),G="myframe",K="<p>После выполнения</p><p>обязательных действий</p><p>кнопка станет активной.</p>",U="",V=0,W="incomplete",X=0;w=setInterval(n,50),window.addEventListener?window.addEventListener("load",t,!1):window.attachEvent?window.attachEvent("onload",t):window.onload=t}var ctrl=new Ctrl;