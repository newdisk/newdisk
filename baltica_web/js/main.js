function Ctrl(){function e(e,s){s.addClass("disabled");var n=!0,i=0,a=0;s.each(function(e,t){"true"===$(t).attr("right")&&a++,$(t).hasClass("selected")&&"true"!==$(t).attr("right")&&(n=!1),$(t).hasClass("selected")&&"true"===$(t).attr("right")&&i++}),n&&i==a?(q.questionList[q.currentQuest].score=100,q.testScore+=100):q.questionList[q.currentQuest].score=0,q.questionList[q.currentQuest].status="answered",$(e).find(".test_questions_panel_question").eq(q.currentQuest).removeAttr("class").addClass("answered");for(var o=0,r=0,c="",l=!0,u=0;u<q.questionList.length;u++)if("answered"!=q.questionList[u].status){l=!1,firstPassed=u;break}l?(q.testScore>0&&(o=Math.floor(q.testScore/q.questionList.length)),c='<p class="big-size"><span>Ваш результат: '+o+"%</span></p>",r=o>=q.successScore?1:-1,c+=r<0?"<p>Тебе не удалось ответить на вопросы итогового тестирования в достаточном объеме.</p><p>"+o+"%  - это недостаточный результат.</p><p>Может быть, ты был невнимателен или что-то отвлекло тебя.</p><p>Для возврата к разделам курса воспользуйся кнопкой «МЕНЮ», повтори материалы и попробуй пройти тестирование еще раз.</p>":"<p>Поздравляем!</p><p>Ты успешно прошёл итоговое тестирование.</p>",q.sendResult(r,o,c)):(q.currentQuest++,t(e,-1))}function t(e,s){if(s>-1)return q.currentQuest=s,void q.makeTask(e,q.currentQuest);if(q.currentQuest>=q.questionList.length){for(var n=0;n<q.questionList.length;n++)if("answered"!=q.questionList[n].status)return q.currentQuest=n,void q.makeTask(e,q.currentQuest)}else"answered"==q.questionList[q.currentQuest].status?(q.currentQuest++,t(e,-1)):q.makeTask(e,q.currentQuest)}function s(){var e=$(document).find("#intro-play"),t=$(document).find(".intro-video");clearInterval(S),document.getElementById("main-preloader").style.display="none",document.getElementById("intro").style.display="block",t.on("ended",function(){e.css("display","block").animate({opacity:0},0).animate({opacity:1},1e3),t.off("ended")})}function n(){$.getJSON("js/courseStructure.json",function(e){q.structure=e,i()}).fail(function(e,t,s){}),$.getJSON("js/test.json",function(e){ee=e}).fail(function(e,t,s){})}function i(){J.slider({range:"min",min:0,max:q.structure.pages.length,animate:"slow"}).slider("disable"),H.animate({opacity:0},0),$("#container").tooltip({items:"[jqtitle]",content:function(){return $(this).attr("jqtitle")}}),$("#course-title").find("p").text(q.structure.course),F.on("click",function(){C(q.bookmark+1)}),U.on("click",function(){C(q.bookmark-1)}),$(".menuBtn").on("click",function(){L||(L=!0,T=!0,l("menu"),E.css("display","block").animate({left:"0px"},400))}),$(".statsBtn").on("click",function(){L||(L=!0,M=!0,l("stats"),I.fadeToggle(400))}),$(".helpBtn").on("click",function(){v()}),$(".menuBtn, .statsBtn, .helpBtn").on("click",function(){H.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){k()})})}),$(".btn_politics").on("click",function(){h(0,"")}),$(".closeAssetBtn").on("click",function(){k()}),G.on("click",function(){q.coursePage.restart(),k()}),K.on("click",function(){C(q.bookmark+1)}),V.on("click",function(){k(),q.openPolitics(q.structure.pages[q.bookmark].linkDoc,q.structure.pages[q.bookmark].linkParagr)}),$(".exitBtn").on("click",function(){w(),$("#container").empty().append('<div id="end"></div>'),setTimeout(function(){window.close()},2e3)}),o(q.structure.pages),r(q.structure.pages),c(q.structure.pages),C(q.bookmark)}function a(){ie+=8,$(".preload-wheel").rotate(ie)}function o(e){if(!(te||te.length>0)){te={},te.pages=[];for(var t=0;t<e.length;t++){var s={};0==t?s.status=1:s.status=0,s.order=t,s.type=e[t].type[0],"ex"!=e[t].type&&"test"!=e[t].type||(s.score=-1),te.pages.push(s)}}}function r(e){q.interactions=[];for(var t=0,s=0;s<e.length;s++)"ex"==e[s].type&&(q.interactions[s]=t,pipwerks.SCORM.set("cmi.interactions."+t+".id",e[s].title),pipwerks.SCORM.set("cmi.interactions."+t+".type","choice"),t++)}function c(e){for(var t='<ul id="menu-list">',s='<ul id="stats-list">',n=0;n<te.pages.length;n++)t+='<li order="'+te.pages[n].order+'" type ="'+te.pages[n].type+'" ',n==q.bookmark&&(t+='class="current"'),t+='><div class="menu-item-status"> </div> <div class="menu-item-num">'+Number(n+1)+".</div><p>"+e[n].title+"</p> </li>","e"==te.pages[n].type&&(s+='<li order="'+te.pages[n].order+'" type ="'+te.pages[n].type+'"> <div class="stats-item-status"> </div> <p>'+e[n].title+"</p> </li>");t+="</ul>",s+="</ul>",$("#menu-body").append(t),$("#stats-exs").append(s),$("#menu-list li, #stats-list li").on("click",function(e){C($(e.target).closest("li").attr("order"))}),$("#stats-progress, #tests-progress").progressbar({max:100})}function l(e){switch(e){case"menu":var t=$("#menu-list").find("li");t.removeClass("current");var s=".menu-item-status";break;case"stats":var t=$("#stats-list").find("li"),s=".stats-item-status",n=u();n.exs.done>0&&$("#stats-msg").text("Упражнений выполнено: "+n.exs.done+" из "+n.exs.num),D.progressbar("value",n.exs.res),D.find(".progress-label")[0].innerHTML=Math.floor(n.exs.res)+"%",z.progressbar("value",n.tests.res),z.find(".progress-label")[0].innerHTML=Math.floor(n.tests.res)+"%"}for(var i,a=0;a<t.length;a++)i=$(t[a]),a==q.bookmark&&i.addClass("current"),"s"!=i.attr("type")&&"c"!=i.attr("type")||1!=te.pages[Number(i.attr("order"))].status||i.find(s).addClass("visited"),"e"!=i.attr("type")&&"t"!=i.attr("type")||(1==te.pages[Number(i.attr("order"))].status?i.find(s).addClass("complited"):te.pages[Number(i.attr("order"))].status==-1&&i.find(s).addClass("failed"))}function u(){for(var e=0,t=0,s=0,n=0,i=0,a=0,o=0,r=0,c=0;c<te.pages.length;c++)"e"==te.pages[c].type&&(te.pages[c].score>0&&(e+=te.pages[c].score),1==te.pages[c].status&&n++,t++),"t"==te.pages[c].type&&(te.pages[c].score>0&&(i+=te.pages[c].score),1==te.pages[c].status&&r++,a++);return t>0&&(s=e/t),a>0&&(o=i/a),{exs:{num:t,res:s,done:n},tests:{num:a,res:o,done:r}}}function d(){E.animate({left:-$("#menu").width()},400,function(){$(this).css("display","none")}),T=!1}function p(){I.fadeToggle(400),M=!1}function f(){j.fadeToggle(400),x=!1}function m(){P.fadeToggle(400),B=!1}function g(){A.fadeToggle(400),Q=!1}function k(){T&&d(),M&&p(),x&&f(),B&&m(),Q&&g(),H.animate({opacity:0},400,function(){$(this).css("display","none").off()}),L=!1}function b(e,t,s,n,i){L&&k(),x=!0,L=!0,e>0?($("#feedback .btn").css("display","none"),K.css("display","inline-block"),$("#feedback-head p").css({color:"#2B7C00"})):($("#feedback .btn").css("display","none"),G.css("display","inline-block"),$("#feedback-head p").css({color:"#7C002F"})),n&&($("#feedback .btn").css("display","none"),q.structure.pages[q.bookmark].linkDoc[0].length>0&&V.css("display","inline-block")),$(".feedback_headComment").text(i),j.stop().fadeToggle(400).find("#feedback-body").html(s),H.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){k()})})}function v(){L||(L=!0,B=!0,P.fadeToggle(400),H.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){k()})}))}function h(e,t){function s(e){A.find(".politics_body_cont").load("pages/"+q.structure.politicsInfo[e].fileURL,function(){t.length>0?$(".politics_body_cont").scrollTop($(t).offset().top):$(this).scrollTop(0)}),$(".politics_list_item").removeClass("current").eq(e).addClass("current")}if(!L){L=!0,Q=!0,A.fadeToggle(400),A.find(".politics_body_menu").html(""),tmpStr='<ul class="politics_body_menu_list">';for(var n=0;n<q.structure.politicsInfo.length;n++)tmpStr+='<li class="politics_list_item" data-index="'+n+'">'+Number(n+1)+". "+q.structure.politicsInfo[n].caption+"</li>";tmpStr+="</ul>",A.find(".politics_body_menu").append(tmpStr),A.find(".politics_body_menu_list li").on("click",function(){s(Number($(this).attr("data-index")))}),e&&void 0!=e||(e=0),s(e),H.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){k()})})}}function y(){for(var e=0,t=0;t<te.pages.length&&!(te.pages[t].status<1);t++)e++;J.slider("value",e)}function C(e){function t(){clearInterval(S),W.css("display","none"),0==e&&v()}var e=Number(e);if(!(e<0||e>q.structure.pages.length-1||e>0&&q.strongNavigation&&te.pages[e-1].status<=0)){"s"==te.pages[e].type&&(te.pages[e].status=1),0==e?(U.addClass("disabled"),F.removeClass("disabled")):e==q.structure.pages.length-1?(F.addClass("disabled").removeAttr("jqtitle"),U.removeClass("disabled")):te.pages[e].status<1?(F.addClass("disabled").attr("jqtitle",Z),U.removeClass("disabled")):(F.removeClass("disabled").removeAttr("jqtitle"),U.removeClass("disabled")),L&&k(),R.text(String(e+1)+"/"+String(q.structure.pages.length)),ctrl.coursePage&&ctrl.coursePage.stop();var s=document.getElementById(Y);s&&N.removeChild(s),N.innerHTML="",q.bookmark=e,$(O).find("p").text(q.structure.pages[e].title),y(),clearInterval(S),X.stop(!0),S=setInterval(a,50),W.css("display","block");var n=document.createElement("iframe");n.addEventListener?n.addEventListener("load",t,!1):n.attachEvent?n.attachEvent("onload",t):n.onload=t,n.src="pages/"+q.structure.pages[e].location+"/index.html",n.name=Y,n.width=n.height="100%",n.frameBorder="0",N.appendChild(n),w()}}function w(){q.success&&(pipwerks.SCORM.set("cmi.location",String(q.bookmark)),pipwerks.SCORM.set("cmi.suspend_data",JSON.stringify(te)),se=u().tests.res,pipwerks.SCORM.set("cmi.score.raw",String(se)),se>=q.successScore?pipwerks.SCORM.set("cmi.completion_status","completed"):pipwerks.SCORM.set("cmi.completion_status","incomplete"),pipwerks.SCORM.save())}var q=this;q.structure,q.bookmark=0,q.successScore=70,q.strongNavigation=!1,q.learner="",q.sendResult=function(e,t,s,n,i){te.pages[q.bookmark].status=e,"e"!=te.pages[q.bookmark].type&&"t"!=te.pages[q.bookmark].type||(te.pages[q.bookmark].score=t),y(),"c"!=te.pages[q.bookmark].type&&("t"!=te.pages[q.bookmark].type&&pipwerks.SCORM.set("cmi.interactions."+q.interactions[q.bookmark]+".result",String(t)),b(e,t,s,n,i)),e>0&&F.removeClass("disabled").removeAttr("jqtitle"),w()},q.makeMeTestQuestionList=function(){function e(e){var t={};return $.extend(!0,t,e)}var t=[];t=t.concat(_.map(_.shuffle(ee.test1.group1),e)),q.questionList=t.slice(0,t.length),q.currentQuest=0,q.testScore=0},q.makeTask=function(e,s){function n(){var t=q.questionList[s].answers;i.append('<div class="answer-wrapper"></div>'),t=_.shuffle(t);for(var n=0;n<t.length;n++)$(e).find(".answer-wrapper").append('<div class="answer" right="'+t[n].right+'">'+t[n].label+'<div class="check-item '+a+'"></div></div>')}var i=$(e).find("#task-body"),a=q.questionList[s].type,o="",r=$(e).find(".test_questions_panel"),c=r.find(".test_questions_panel_body");i.empty(),i.append('<p id="test-quest-num">'+Number(s+1)+"/"+q.questionList.length+"</p>"),o="single"==a?"Выберите один ответ.":"Выберите один или несколько ответов.",i.append('<p id="test-quest-txt">'+q.questionList[s].question+"<br/><span>"+o+"</span></p>"),c.empty();for(var l="",u=0;u<q.questionList.length;u++)l+='<div class="test_questions_panel_question '+q.questionList[u].status,s==u&&(l+=" current"),l+='" order="'+u+'">'+Number(u+1)+"</div>";switch(c.append(l),a){case"single":a="radio",n(),q.makeTestSingleTask(e);break;case"multi":a="box",n(),q.makeTestMultiTask(e)}$(e).find(".test_questions_panel_question").on("click",function(){var s=Number($(this).attr("order"));s!=q.currentQuest&&"answered"!=q.questionList[s].status&&(q.questionList[q.currentQuest].status="passed",t(e,s))})},q.makeTestSingleTask=function(s){function n(){o.removeClass("selected"),$(this).addClass("selected");var e=!1;o.each(function(t,s){$(s).hasClass("selected")&&(e=!0)}),e?i.attr("disabled",!1).removeClass("disabled"):i.attr("disabled",!0).addClass("disabled")}var i=$(s).find("#test-answBtn"),a=$(s).find(".test_btn_pass"),o=$(s).find(".answer");i.off("click").on("click",function(){e(s,o)}).addClass("disabled").attr("disabled",!0),a.off("click").on("click",function(){q.questionList[q.currentQuest].status="passed",q.currentQuest++,t(s,-1)}),o.off("click").on("click",n)},q.makeTestMultiTask=function(s){function n(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected");var e=!1;o.each(function(t,s){$(s).hasClass("selected")&&(e=!0)}),e?i.attr("disabled",!1).removeClass("disabled"):i.attr("disabled",!0).addClass("disabled")}var i=$(s).find("#test-answBtn"),a=$(s).find(".test_btn_pass"),o=$(s).find(".answer");i.off("click").on("click",function(){e(s,o)}).addClass("disabled").attr("disabled",!0),a.off("click").on("click",function(){q.questionList[q.currentQuest].status="passed",q.currentQuest++,t(s,-1)}),o.off("click").on("click",n)},q.printCert=function(){window.open("pages/cert/index.html","printPage","width=1024, height=768")},q.startCourse=function(){if(document.getElementById("intro").style.display="none",document.getElementById("container").style.display="block",pipwerks.SCORM.version="2004",q.success=pipwerks.SCORM.init(),q.success){document.getElementById("hello").innerHTML="";var e=pipwerks.SCORM.get("cmi.completion_status");e&&(ne=e),e=pipwerks.SCORM.get("cmi.location"),(e||void 0!=e||"undefined"!=e||"NaN"!=e)&&(q.bookmark=Number(e)),e=pipwerks.SCORM.get("cmi.suspend_data"),e&&e.length>0&&(te=JSON.parse(e)),e=pipwerks.SCORM.get("cmi.score.raw"),e&&e.length>0&&(se=e),e=pipwerks.SCORM.get("cmi.learner_name"),e&&(q.learner=e)}else document.getElementById("hello").innerHTML="No LMS detected.";n()};var S,L=!1,T=!1,M=!1,x=!1,B=!1,Q=!1,N=document.getElementById("page-container"),O=document.getElementById("page-title"),R=$(".paginator"),E=$("#menu"),I=$("#stats"),j=$("#feedback"),P=$("#help"),A=$(".politics"),H=$("#dark"),J=$("#progress-bar"),D=$("#stats-progress"),z=$("#tests-progress"),F=$(".nextBtn"),U=$(".prevBtn"),G=$(".againBtn"),K=$(".continueBtn"),V=$(".show-politic"),W=$("#page-preloader"),X=$(".preload-wheel"),Y="myframe",Z="<p>После выполнения</p><p>обязательных действий</p><p>кнопка станет активной.</p>",ee=[],te="",se=0,ne="incomplete",ie=0;S=setInterval(a,50),window.addEventListener?window.addEventListener("load",s,!1):window.attachEvent?window.attachEvent("onload",s):window.onload=s,q.openPolitics=function(e,t){h(e,t)},q.goToPage=function(e){C(e)}}var ctrl=new Ctrl;$("#intro-play").on("click",ctrl.startCourse);