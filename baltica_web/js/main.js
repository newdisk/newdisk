function Ctrl(){function t(t,s){s.addClass("disabled");var n=!0,i=0,a=0;s.each(function(t,e){"true"===$(e).attr("right")&&a++,$(e).hasClass("selected")&&"true"!==$(e).attr("right")&&(n=!1),$(e).hasClass("selected")&&"true"===$(e).attr("right")&&i++}),n&&i==a?(q.questionList[q.currentQuest].score=100,q.testScore+=100):q.questionList[q.currentQuest].score=0,q.questionList[q.currentQuest].status="answered",$(t).find(".test_questions_panel_question").eq(q.currentQuest).removeAttr("class").addClass("answered");for(var o=0,r=0,c="",l=!0,u=0;u<q.questionList.length;u++)if("answered"!=q.questionList[u].status){l=!1,firstPassed=u;break}l?(q.testScore>0&&(o=Math.floor(q.testScore/q.questionList.length)),r=o>=q.successScore?1:-1,c+=o>69?"<p>Ты прошел итоговый тест.</p><p>Твой результат составил "+o+"%</p><p>Поздравляем, ты успешно справился с итоговым тестированием!</p>":"<p>Ты прошел итоговый тест.</p><p>Твой результат составил "+o+"%</p><p>Настоятельно рекомендуем повторить материалы курса и пройти итоговый тест еще раз.</p>",q.sendResult(r,o,c)):(q.currentQuest++,e(t,-1))}function e(t,s){if(s>-1)return q.currentQuest=s,void q.makeTask(t,q.currentQuest);if(q.currentQuest>=q.questionList.length){for(var n=0;n<q.questionList.length;n++)if("answered"!=q.questionList[n].status)return q.currentQuest=n,void q.makeTask(t,q.currentQuest)}else"answered"==q.questionList[q.currentQuest].status?(q.currentQuest++,e(t,-1)):q.makeTask(t,q.currentQuest)}function s(){var t=$(document).find("#intro-play"),e=$(document).find(".intro-video");clearInterval(S),document.getElementById("main-preloader").style.display="none",document.getElementById("intro").style.display="block",e.on("ended",function(){t.css("display","block").animate({opacity:0},0).animate({opacity:1},1e3),e.off("ended")})}function n(){$.getJSON("js/courseStructure.json",function(t){q.structure=t,i()}).fail(function(t,e,s){}),$.getJSON("js/test.json",function(t){tt=t}).fail(function(t,e,s){})}function i(){J.slider({range:"min",min:0,max:q.structure.pages.length,animate:"slow"}).slider("disable"),H.animate({opacity:0},0),$("#container").tooltip({items:"[jqtitle]",content:function(){return $(this).attr("jqtitle")}}),$("#course-title").find("p").text(q.structure.course),U.on("click",function(){C(q.bookmark+1)}),z.on("click",function(){C(q.bookmark-1)}),$(".menuBtn").on("click",function(){L||(L=!0,T=!0,l("menu"),E.css("display","block").animate({left:"0px"},400))}),$(".statsBtn").on("click",function(){L||(L=!0,M=!0,l("stats"),I.fadeToggle(400))}),$(".helpBtn").on("click",function(){v()}),$(".menuBtn, .statsBtn, .helpBtn").on("click",function(){H.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){k()})})}),$(".btn_politics").on("click",function(){h(0,"")}),$(".closeAssetBtn").on("click",function(){k()}),G.on("click",function(){q.coursePage.restart(),k()}),K.on("click",function(){C(q.bookmark+1)}),V.on("click",function(){k(),q.openPolitics(q.structure.pages[q.bookmark].linkDoc,q.structure.pages[q.bookmark].linkParagr)}),$(".exitBtn").on("click",function(){w(),$("#container").empty().append('<div id="end"></div>'),setTimeout(function(){window.close()},2e3)}),o(q.structure.pages),r(q.structure.pages),c(q.structure.pages),C(q.bookmark)}function a(){it+=8,$(".preload-wheel").rotate(it)}function o(t){if(!(et||et.length>0)){et={},et.pages=[];for(var e=0;e<t.length;e++){var s={};0==e?s.status=1:s.status=0,s.order=e,s.type=t[e].type[0],"ex"!=t[e].type&&"test"!=t[e].type||(s.score=-1),et.pages.push(s)}}}function r(t){q.interactions=[];for(var e=0,s=0;s<t.length;s++)"ex"==t[s].type&&(q.interactions[s]=e,pipwerks.SCORM.set("cmi.interactions."+e+".id",t[s].title),pipwerks.SCORM.set("cmi.interactions."+e+".type","choice"),e++)}function c(t){for(var e='<ul id="menu-list">',s='<ul id="stats-list">',n=0;n<et.pages.length;n++)e+='<li order="'+et.pages[n].order+'" type ="'+et.pages[n].type+'" ',n==q.bookmark&&(e+='class="current"'),e+='><div class="menu-item-status"> </div> <div class="menu-item-num">'+Number(n+1)+".</div><p>"+t[n].title+"</p> </li>","e"==et.pages[n].type&&(s+='<li order="'+et.pages[n].order+'" type ="'+et.pages[n].type+'"> <div class="stats-item-status"> </div> <p>'+t[n].title+"</p> </li>");e+="</ul>",s+="</ul>",$("#menu-body").append(e),$("#stats-exs").append(s),$("#menu-list li, #stats-list li").on("click",function(t){C($(t.target).closest("li").attr("order"))}),$("#stats-progress, #tests-progress").progressbar({max:100})}function l(t){switch(t){case"menu":var e=$("#menu-list").find("li");e.removeClass("current");var s=".menu-item-status";break;case"stats":var e=$("#stats-list").find("li"),s=".stats-item-status",n=u();n.exs.done>0&&$("#stats-msg").text("Упражнений выполнено: "+n.exs.done+" из "+n.exs.num),D.progressbar("value",n.exs.res),D.find(".progress-label")[0].innerHTML=Math.floor(n.exs.res)+"%",F.progressbar("value",n.tests.res),F.find(".progress-label")[0].innerHTML=Math.floor(n.tests.res)+"%"}for(var i,a=0;a<e.length;a++)i=$(e[a]),a==q.bookmark&&i.addClass("current"),"s"!=i.attr("type")&&"c"!=i.attr("type")||1!=et.pages[Number(i.attr("order"))].status||i.find(s).addClass("visited"),"e"!=i.attr("type")&&"t"!=i.attr("type")||(1==et.pages[Number(i.attr("order"))].status?i.find(s).addClass("complited"):et.pages[Number(i.attr("order"))].status==-1&&i.find(s).addClass("failed"))}function u(){for(var t=0,e=0,s=0,n=0,i=0,a=0,o=0,r=0,c=0;c<et.pages.length;c++)"e"==et.pages[c].type&&(et.pages[c].score>0&&(t+=et.pages[c].score),1==et.pages[c].status&&n++,e++),"t"==et.pages[c].type&&(et.pages[c].score>0&&(i+=et.pages[c].score),1==et.pages[c].status&&r++,a++);return e>0&&(s=t/e),a>0&&(o=i/a),{exs:{num:e,res:s,done:n},tests:{num:a,res:o,done:r}}}function d(){E.animate({left:-$("#menu").width()},400,function(){$(this).css("display","none")}),T=!1}function p(){I.fadeToggle(400),M=!1}function f(){j.fadeToggle(400),x=!1}function m(){P.fadeToggle(400),B=!1}function g(){A.fadeToggle(400),Q=!1}function k(){T&&d(),M&&p(),x&&f(),B&&m(),Q&&g(),H.animate({opacity:0},400,function(){$(this).css("display","none").off()}),L=!1}function b(t,e,s,n,i){L&&k(),x=!0,L=!0,t>0?($("#feedback .btn").css("display","none"),K.css("display","inline-block"),$("#feedback-head p").css({color:"#2B7C00"})):($("#feedback .btn").css("display","none"),G.css("display","inline-block"),$("#feedback-head p").css({color:"#7C002F"})),n&&1!==t&&($("#feedback .btn").css("display","none"),q.structure.pages[q.bookmark].linkDoc[0].length>0&&V.css("display","inline-block")),$(".feedback_headComment").text(i),j.stop().fadeToggle(400).find("#feedback-body").html(s),H.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){k()})})}function v(){L||(L=!0,B=!0,P.fadeToggle(400),H.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){k()})}))}function h(t,e){function s(t){A.find(".politics_body_cont").load("pages/"+q.structure.politicsInfo[t].fileURL,function(){$(this).scrollTop(0),e.length>0&&$(".politics_body_cont").scrollTop($(e).offset().top-$(".politics_body_cont").offset().top)}),$(".politics_list_item").removeClass("current").eq(t).addClass("current")}if(!L){L=!0,Q=!0,A.fadeToggle(400),A.find(".politics_body_menu").html(""),tmpStr='<ul class="politics_body_menu_list">';for(var n=0;n<q.structure.politicsInfo.length;n++)tmpStr+='<li class="politics_list_item" data-index="'+n+'">'+Number(n+1)+". "+q.structure.politicsInfo[n].caption+"</li>";tmpStr+="</ul>",A.find(".politics_body_menu").append(tmpStr),A.find(".politics_body_menu_list li").on("click",function(){s(Number($(this).attr("data-index")))}),t&&void 0!=t||(t=0),s(t),H.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){k()})})}}function y(){for(var t=0,e=0;e<et.pages.length&&!(et.pages[e].status<1);e++)t++;J.slider("value",t)}function C(t){function e(){clearInterval(S),W.css("display","none"),0==t&&v()}var t=Number(t);if(!(t<0||t>q.structure.pages.length-1||t>0&&q.strongNavigation&&et.pages[t-1].status<=0)){"s"==et.pages[t].type&&(et.pages[t].status=1),0==t?(z.addClass("disabled"),U.removeClass("disabled")):t==q.structure.pages.length-1?(U.addClass("disabled").removeAttr("jqtitle"),z.removeClass("disabled")):et.pages[t].status<1?(U.addClass("disabled").attr("jqtitle",Z),z.removeClass("disabled")):(U.removeClass("disabled").removeAttr("jqtitle"),z.removeClass("disabled")),L&&k(),R.text(String(t+1)+"/"+String(q.structure.pages.length)),ctrl.coursePage&&ctrl.coursePage.stop();var s=document.getElementById(Y);s&&N.removeChild(s),N.innerHTML="",q.bookmark=t,$(O).find("p").text(q.structure.pages[t].title),y(),clearInterval(S),X.stop(!0),S=setInterval(a,50),W.css("display","block");var n=document.createElement("iframe");n.addEventListener?n.addEventListener("load",e,!1):n.attachEvent?n.attachEvent("onload",e):n.onload=e,n.src="pages/"+q.structure.pages[t].location+"/index.html",n.name=Y,n.width=n.height="100%",n.frameBorder="0",N.appendChild(n),w()}}function w(){q.success&&(pipwerks.SCORM.set("cmi.location",String(q.bookmark)),pipwerks.SCORM.set("cmi.suspend_data",JSON.stringify(et)),st=u().tests.res,pipwerks.SCORM.set("cmi.score.raw",String(st)),st>=q.successScore?pipwerks.SCORM.set("cmi.completion_status","completed"):pipwerks.SCORM.set("cmi.completion_status","incomplete"),pipwerks.SCORM.save())}var q=this;q.structure,q.bookmark=0,q.successScore=70,q.strongNavigation=!1,q.learner="",q.sendResult=function(t,e,s,n,i){et.pages[q.bookmark].status=t,"e"!=et.pages[q.bookmark].type&&"t"!=et.pages[q.bookmark].type||(et.pages[q.bookmark].score=e),y(),"c"!=et.pages[q.bookmark].type&&("t"!=et.pages[q.bookmark].type&&pipwerks.SCORM.set("cmi.interactions."+q.interactions[q.bookmark]+".result",String(e)),b(t,e,s,n,i)),t>0&&U.removeClass("disabled").removeAttr("jqtitle"),w()},q.makeMeTestQuestionList=function(){function t(t){var e={};return $.extend(!0,e,t)}var e=[];e=e.concat(_.map(_.shuffle(tt.test1.group1),t)),q.questionList=e.slice(0,e.length),q.currentQuest=0,q.testScore=0},q.makeTask=function(t,s){function n(){var e=q.questionList[s].answers;i.append('<div class="answer-wrapper"></div>'),e=_.shuffle(e);for(var n=0;n<e.length;n++)$(t).find(".answer-wrapper").append('<div class="answer" right="'+e[n].right+'">'+e[n].label+'<div class="check-item '+a+'"></div></div>')}var i=$(t).find("#task-body"),a=q.questionList[s].type,o="",r=$(t).find(".test_questions_panel"),c=r.find(".test_questions_panel_body");i.empty(),i.append('<p id="test-quest-num">'+Number(s+1)+"/"+q.questionList.length+"</p>"),o="single"==a?"Выбери один ответ.":"Выбери один или несколько ответов.",i.append('<p id="test-quest-txt">'+q.questionList[s].question+"<br/><span>"+o+"</span></p>"),c.empty();for(var l="",u=0;u<q.questionList.length;u++)l+='<div class="test_questions_panel_question '+q.questionList[u].status,s==u&&(l+=" current"),l+='" order="'+u+'">'+Number(u+1)+"</div>";switch(c.append(l),a){case"single":a="radio",n(),q.makeTestSingleTask(t);break;case"multi":a="box",n(),q.makeTestMultiTask(t)}$(t).find(".test_questions_panel_question").on("click",function(){var s=Number($(this).attr("order"));s!=q.currentQuest&&"answered"!=q.questionList[s].status&&(q.questionList[q.currentQuest].status="passed",e(t,s))})},q.makeTestSingleTask=function(s){function n(){o.removeClass("selected"),$(this).addClass("selected");var t=!1;o.each(function(e,s){$(s).hasClass("selected")&&(t=!0)}),t?i.attr("disabled",!1).removeClass("disabled"):i.attr("disabled",!0).addClass("disabled")}var i=$(s).find("#test-answBtn"),a=$(s).find(".test_btn_pass"),o=$(s).find(".answer");i.off("click").on("click",function(){t(s,o)}).addClass("disabled").attr("disabled",!0),a.off("click").on("click",function(){q.questionList[q.currentQuest].status="passed",q.currentQuest++,e(s,-1)}),o.off("click").on("click",n)},q.makeTestMultiTask=function(s){function n(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected");var t=!1;o.each(function(e,s){$(s).hasClass("selected")&&(t=!0)}),t?i.attr("disabled",!1).removeClass("disabled"):i.attr("disabled",!0).addClass("disabled")}var i=$(s).find("#test-answBtn"),a=$(s).find(".test_btn_pass"),o=$(s).find(".answer");i.off("click").on("click",function(){t(s,o)}).addClass("disabled").attr("disabled",!0),a.off("click").on("click",function(){q.questionList[q.currentQuest].status="passed",q.currentQuest++,e(s,-1)}),o.off("click").on("click",n)},q.printCert=function(){window.open("pages/cert/index.html","printPage","width=1024, height=768")},q.startCourse=function(){if(document.getElementById("intro").style.display="none",document.getElementById("container").style.display="block",pipwerks.SCORM.version="2004",q.success=pipwerks.SCORM.init(),q.success){document.getElementById("hello").innerHTML="";var t=pipwerks.SCORM.get("cmi.completion_status");t&&(nt=t),t=pipwerks.SCORM.get("cmi.location"),(t||void 0!=t||"undefined"!=t||"NaN"!=t)&&(q.bookmark=Number(t)),t=pipwerks.SCORM.get("cmi.suspend_data"),t&&t.length>0&&(et=JSON.parse(t)),t=pipwerks.SCORM.get("cmi.score.raw"),t&&t.length>0&&(st=t),t=pipwerks.SCORM.get("cmi.learner_name"),t&&(q.learner=t)}else document.getElementById("hello").innerHTML="No LMS detected.";n()};var S,L=!1,T=!1,M=!1,x=!1,B=!1,Q=!1,N=document.getElementById("page-container"),O=document.getElementById("page-title"),R=$(".paginator"),E=$("#menu"),I=$("#stats"),j=$("#feedback"),P=$("#help"),A=$(".politics"),H=$("#dark"),J=$("#progress-bar"),D=$("#stats-progress"),F=$("#tests-progress"),U=$(".nextBtn"),z=$(".prevBtn"),G=$(".againBtn"),K=$(".continueBtn"),V=$(".show-politic"),W=$("#page-preloader"),X=$(".preload-wheel"),Y="myframe",Z="<p>После выполнения</p><p>обязательных действий</p><p>кнопка станет активной.</p>",tt=[],et="",st=0,nt="incomplete",it=0;S=setInterval(a,50),window.addEventListener?window.addEventListener("load",s,!1):window.attachEvent?window.attachEvent("onload",s):window.onload=s,q.openPolitics=function(t,e){h(t,e)},q.goToPage=function(t){C(t)}}var ctrl=new Ctrl;$("#intro-play").on("click",ctrl.startCourse);