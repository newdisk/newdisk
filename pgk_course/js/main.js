function Ctrl(){function e(e,t){t.addClass("disabled");var s=0,a=0,n="",i=!0,r=0,o=0;t.each(function(e,t){"true"===$(t).attr("right")&&o++,$(t).hasClass("selected")&&"true"!==$(t).attr("right")&&(i=!1),$(t).hasClass("selected")&&"true"===$(t).attr("right")&&r++}),i&&r==o&&(y.testScore+=100),y.currentQuest++,y.currentQuest>=y.questionList.length?(y.testScore>0&&(s=Math.floor(y.testScore/y.questionList.length)),n='<p class="big-size"><span>Ваш результат: '+s+"%</span></p>",a=s>=y.successScore?1:-1,a<0?n+="<p>Вам не удалось ответить на вопросы итогового тестирования в достаточном объеме.</p><p>"+s+"%  - это недостаточный результат.</p><p>Может быть, вы были невнимательны или что-то отвлекло вас.</p><p>Для возврата к разделам курса воспользуйтесь кнопкой «МЕНЮ», повторите материалы и попробуйте пройти тестирование еще раз.</p>":(y.success&&(y.learner=pipwerks.SCORM.get("cmi.learner_name")),n+="<p>Поздравляем!</p><p>Вы успешно прошли итоговое тестирование учебного курса «Антикоррупционная политика АО «ПГК».</p>"),y.sendResult(a,s,n)):y.makeTask(e,y.currentQuest)}function t(){clearInterval(S),document.getElementById("main-preloader").style.display="none",document.getElementById("intro").style.display="block"}function s(){$.getJSON("js/courseStructure.json",function(e){y.structure=e,a()}).fail(function(e,t,s){}),$.getJSON("js/test.json",function(e){C=e}).fail(function(e,t,s){})}function a(){A.slider({range:"min",min:0,max:y.structure.pages.length,animate:"slow"}).slider("disable"),j.animate({opacity:0},0),$("#container").tooltip({items:"[jqtitle]",content:function(){return $(this).attr("jqtitle")}}),$("#course-title").find("p").text(y.structure.course),J.on("click",function(){v(y.bookmark+1)}),P.on("click",function(){v(y.bookmark-1)}),$("#menuBtn").on("click",function(){w||(w=!0,M=!0,c("menu"),E.css("display","block").animate({left:"0px"},400))}),$("#statsBtn").on("click",function(){w||(w=!0,B=!0,c("stats"),L.fadeToggle(400))}),$("#helpBtn").on("click",function(){k()}),$("#menuBtn, #statsBtn, #helpBtn").on("click",function(){j.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){g()})})}),$(".closeAssetBtn").on("click",function(){g()}),z.on("click",function(){y.coursePage.restart(),g()}),F.on("click",function(){v(y.bookmark+1)}),$("#exitBtn").on("click",function(){h(),$("#container").empty().append('<div id="end"></div>'),setTimeout(function(){window.close()},2e3)}),i(y.structure.pages),r(y.structure.pages),o(y.structure.pages),v(y.bookmark)}function n(){Y+=8,$(".preload-wheel").rotate(Y)}function i(e){if(!(V||V.length>0)){V={},V.pages=[];for(var t=0;t<e.length;t++){var s={};s.score=0,0==t?(s.status=1,s.score=100):s.status=0,s.order=t,s.type=e[t].type[0],"ex"!=e[t].type&&"test"!=e[t].type||(s.score=-1),V.pages.push(s)}}}function r(e){y.interactions=[];for(var t=0,s=0;s<e.length;s++)"ex"==e[s].type&&(y.interactions[s]=t,pipwerks.SCORM.set("cmi.interactions."+t+".id",e[s].title),pipwerks.SCORM.set("cmi.interactions."+t+".type","choice"),t++)}function o(e){for(var t='<ul id="menu-list">',s='<ul id="stats-list">',a=0;a<V.pages.length;a++)t+='<li order="'+V.pages[a].order+'" type ="'+V.pages[a].type+'" ',a==y.bookmark&&(t+='class="current"'),t+='><div class="menu-item-status"> </div> <div class="menu-item-num">'+Number(a+1)+".</div><p>"+e[a].title+"</p> </li>","e"==V.pages[a].type&&(s+='<li order="'+V.pages[a].order+'" type ="'+V.pages[a].type+'"> <div class="stats-item-status"> </div> <p>'+e[a].title+"</p> </li>");t+="</ul>",s+="</ul>",$("#menu-body").append(t),$("#stats-exs").append(s),$("#menu-list li, #stats-list li").on("click",function(e){v($(e.target).closest("li").attr("order"))}),$("#stats-progress, #tests-progress").progressbar({max:100})}function c(e){switch(e){case"menu":var t=$("#menu-list").find("li");t.removeClass("current");var s=".menu-item-status";break;case"stats":var t=$("#stats-list").find("li"),s=".stats-item-status",a=l();a.exs.done>0&&$("#stats-msg").text("Упражнений выполнено: "+a.exs.done+" из "+a.exs.num),H.progressbar("value",a.exs.res),H.find(".progress-label")[0].innerHTML=Math.floor(a.exs.res)+"%",Q.progressbar("value",a.tests.res),Q.find(".progress-label")[0].innerHTML=Math.floor(a.tests.res)+"%"}for(var n,i=0;i<t.length;i++)n=$(t[i]),i==y.bookmark&&n.addClass("current"),"s"!=n.attr("type")&&"c"!=n.attr("type")||1!=V.pages[Number(n.attr("order"))].status||n.find(s).addClass("visited"),"e"!=n.attr("type")&&"t"!=n.attr("type")||(1==V.pages[Number(n.attr("order"))].status?n.find(s).addClass("complited"):V.pages[Number(n.attr("order"))].status==-1&&n.find(s).addClass("failed"))}function l(){for(var e=0,t=0,s=0,a=0,n=0,i=0,r=0,o=0,c=0;c<V.pages.length;c++)"e"==V.pages[c].type&&(V.pages[c].score>0&&(e+=V.pages[c].score),1==V.pages[c].status&&a++,t++),"t"==V.pages[c].type&&(V.pages[c].score>0&&(n+=V.pages[c].score),1==V.pages[c].status&&o++,i++);return t>0&&(s=e/t),i>0&&(r=n/i),{exs:{num:t,res:s,done:a},tests:{num:i,res:r,done:o}}}function d(){E.animate({left:-$("#menu").width()},400,function(){$(this).css("display","none")}),M=!1}function p(){L.fadeToggle(400),B=!1}function u(){N.fadeToggle(400),T=!1}function m(){I.fadeToggle(400),x=!1}function g(){M&&d(),B&&p(),T&&u(),x&&m(),j.animate({opacity:0},400,function(){$(this).css("display","none").off()}),w=!1}function f(e,t,s,a){w&&g(),T=!0,w=!0,e>0?(z.css("display","none"),F.css("display","inline-block"),$("#feedback-head p").css({color:"#2B7C00"})):(z.css("display","inline-block"),F.css("display","none"),$("#feedback-head p").css({color:"#7C002F"})),a&&(z.css("display","none"),F.css("display","none")),N.stop().fadeToggle(400).find("#feedback-body").html(s),j.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){g()})})}function k(){w||(w=!0,x=!0,I.fadeToggle(400),j.css("display","block").animate({opacity:.4},400,function(){$(this).on("click",function(){g()})}))}function b(){for(var e=0,t=0;t<V.pages.length&&!(V.pages[t].status<1);t++)e++;A.slider("value",e)}function v(e){function t(){clearInterval(S),D.css("display","none"),0==e&&k()}var e=Number(e);if(!(e<0||e>y.structure.pages.length-1||e>0&&y.strongNavigation&&V.pages[e-1].score<y.pageSuccessScore)){"s"==V.pages[e].type&&(V.pages[e].status=1,V.pages[e].score=100),0==e?(P.addClass("disabled"),J.removeClass("disabled")):e==y.structure.pages.length-1?(J.addClass("disabled").removeAttr("jqtitle"),P.removeClass("disabled")):V.pages[e].score<y.pageSuccessScore?(J.addClass("disabled").attr("jqtitle",U),P.removeClass("disabled")):"t"==V.pages[y.bookmark].type?V.pages[y.bookmark].score>y.SuccessScore&&J.removeClass("disabled").removeAttr("jqtitle"):(J.removeClass("disabled").removeAttr("jqtitle"),P.removeClass("disabled")),w&&g(),q.text(String(e+1)+"/"+String(y.structure.pages.length)),ctrl.coursePage&&ctrl.coursePage.stop();var s=document.getElementById(K);s&&O.removeChild(s),O.innerHTML="",y.bookmark=e,$(R).find("p").text(y.structure.pages[e].title),b(),clearInterval(S),G.stop(!0),S=setInterval(n,50),D.css("display","block");var a=document.createElement("iframe");a.addEventListener?a.addEventListener("load",t,!1):a.attachEvent?a.attachEvent("onload",t):a.onload=t,a.src="pages/"+y.structure.pages[e].location+"/index.html",a.name=K,a.width=a.height="100%",a.frameBorder="0",O.appendChild(a),h()}}function h(){y.success&&(pipwerks.SCORM.set("cmi.location",String(y.bookmark)),pipwerks.SCORM.set("cmi.suspend_data",JSON.stringify(V)),W=l().tests.res,pipwerks.SCORM.set("cmi.score.raw",String(W)),W>=y.successScore?pipwerks.SCORM.set("cmi.completion_status","completed"):pipwerks.SCORM.set("cmi.completion_status","incomplete"),pipwerks.SCORM.save())}var y=this;y.structure,y.bookmark=0,y.successScore=80,y.pageSuccessScore=1,y.strongNavigation=!0,y.learner="Имя обучаемого",y.sendResult=function(e,t,s,a){V.pages[y.bookmark].status=e,V.pages[y.bookmark].score=t,b(),"c"!=V.pages[y.bookmark].type&&("t"!=V.pages[y.bookmark].type&&pipwerks.SCORM.set("cmi.interactions."+y.interactions[y.bookmark]+".result",String(t)),f(e,t,s,a)),"t"==V.pages[y.bookmark].type?V.pages[y.bookmark].score>y.SuccessScore&&J.removeClass("disabled").removeAttr("jqtitle"):V.pages[y.bookmark].score>y.pageSuccessScore&&J.removeClass("disabled").removeAttr("jqtitle"),h()},y.makeMeTestQuestionList=function(){var e=4,t=4,s=6,a=6,n=[];n=n.concat(_.shuffle(C.test1.group1),_.sample(C.test1.group2,e),_.sample(C.test1.group3,t),_.sample(C.test1.group4,s),_.sample(C.test1.group5,a)),y.questionList=n,y.currentQuest=0,y.testScore=0},y.makeTask=function(e,t){function s(){var e=y.questionList[t].answers;e=_.shuffle(e);for(var s=0;s<e.length;s++)a.append('<div class="answer" right="'+e[s].right+'">'+e[s].label+'<div class="check-item '+n+'"></div></div>')}var a=$(e).find("#task-body"),n=y.questionList[t].type,i="";switch(a.empty(),a.append('<p id="test-quest-num">'+Number(t+1)+"/"+y.questionList.length+"</p>"),i="single"==n?"Выберите один ответ.":"Выберите один или несколько ответов.",a.append('<p id="test-quest-txt">'+y.questionList[t].question+"<br/><span>"+i+"</span></p>"),n){case"single":n="radio",s(),y.makeTestSingleTask(e);break;case"multi":n="box",s(),y.makeTestMultiTask(e)}},y.makeTestSingleTask=function(t){function s(){n.removeClass("selected"),$(this).addClass("selected");var e=!1;n.each(function(t,s){$(s).hasClass("selected")&&(e=!0)}),e?a.attr("disabled",!1).removeClass("disabled"):a.attr("disabled",!0).addClass("disabled")}var a=$(t).find("#test-answBtn"),n=$(t).find(".answer");a.off("click").on("click",function(){e(t,n)}).addClass("disabled").attr("disabled",!0),n.off("click").on("click",s)},y.makeTestMultiTask=function(t){function s(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected");var e=!1;n.each(function(t,s){$(s).hasClass("selected")&&(e=!0)}),e?a.attr("disabled",!1).removeClass("disabled"):a.attr("disabled",!0).addClass("disabled")}var a=$(t).find("#test-answBtn"),n=$(t).find(".answer");a.off("click").on("click",function(){e(t,n)}).addClass("disabled").attr("disabled",!0),n.off("click").on("click",s)},y.printCert=function(){window.open("pages/cert/index.html","printPage","width=1024, height=768")},y.startCourse=function(){if(document.getElementById("intro").style.display="none",document.getElementById("container").style.display="block",pipwerks.SCORM.version="2004",y.success=pipwerks.SCORM.init(),y.success){document.getElementById("hello").innerHTML="";var e=pipwerks.SCORM.get("cmi.completion_status");e&&(X=e),e=pipwerks.SCORM.get("cmi.location"),(e||void 0!=e||"undefinded"!=e||"NaN"!=e)&&(y.bookmark=Number(e)),e=pipwerks.SCORM.get("cmi.suspend_data"),e&&e.length>0&&(V=JSON.parse(e)),e=pipwerks.SCORM.get("cmi.score.raw"),e&&e.length>0&&(W=e),W>=y.successScore&&(y.learner=pipwerks.SCORM.get("cmi.learner_name"))}else document.getElementById("hello").innerHTML="No LMS detected.";s()};var C,S,w=!1,M=!1,B=!1,T=!1,x=!1,O=document.getElementById("page-container"),R=document.getElementById("page-title"),q=$(".paginator"),E=$("#menu"),L=$("#stats"),N=$("#feedback"),I=$("#help"),j=$("#dark"),A=$("#progress-bar"),H=$("#stats-progress"),Q=$("#tests-progress"),J=$(".nextBtn"),P=$(".prevBtn"),z=$("#againBtn"),F=$("#continueBtn"),D=$("#page-preloader"),G=$(".preload-wheel"),K="myframe",U="<p>После выполнения</p><p>обязательных действий</p><p>кнопка станет активной.</p>",V="",W=0,X="incomplete",Y=0;S=setInterval(n,50),window.addEventListener?window.addEventListener("load",t,!1):window.attachEvent?window.attachEvent("onload",t):window.onload=t}var ctrl=new Ctrl;