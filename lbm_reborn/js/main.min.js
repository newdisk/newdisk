"use strict";var courseStructure={course:"Легко ли быть менеджером?",description:"Модульный курс для дистанционного обучения",chapters:[{id:1,title:"Глава 1",pages:[{id:1,title:"Page 1",location:"page01",type:"simple_page",messages:[""]},{id:2,title:"Page 2",location:"page02",type:"simple_page",messages:[""]}]},{id:2,title:"Глава 2",pages:[{id:1,title:"Page01 in ch 2",location:"page01",type:"simple_page",messages:[""]},{id:2,title:"Упражнение №2",location:"page03",type:"exercise",data:{attempts:-1,shuffle:!0,showAnswer:!1,useVideo:!0,videoPoster:"img/video.svg",videoUrl:"video/r1.mp4",videoWidth:640,videoHeight:480,taskText:"Посмотрите киноэпизод. Прокомментируйте высказывания героя фильма. Раскрасте в зелёный цвет ты высказывания, с которыми согласны, а в красный те, с которыми не согласны.",questionList:[{label:"Мотивировать - это дело руководства: пусть зарплату повышают.",right:0},{label:"МотивОрганизовывать... тоже никого не надо, все знают, что им делать.",right:1},{label:"А вот контролировать - это нужно.",right:0},{label:"Надо наказывать почаще, а то избаловались, всё на начальство сваливают.",right:1},{label:"Правильный вариант для ассортимента.",right:1}]},messages:["Правильный ответ!","Ответ неверный!"]},{id:3,title:"Итоговое тестирование",location:"page_final_test",type:"test",messages:[""]}]}]},testStructure={tests:[{testId:0,caption:"final_test",type:"section",groups:[{caption:"group1",qUse:"all",questions:[{question:"Закончите предложение: «При реализации системы управления по целям устанавливают цели для выполнения работы и развития ...»",score:-1,status:"notanswered",type:"single",answers:[{label:"руководители",right:!1},{label:"руководители совместно с подчиненными",right:!0},{label:"сами подчиненные",right:!1}]},{question:"При управлении по целям интегрируются и реализуются:",score:-1,status:"notanswered",type:"single",answers:[{label:"Организационные, групповые и индивидуальные",right:!0},{label:"Организационные и групповые цели",right:!1},{label:"Организационные и индивидуальные цели",right:!1},{label:"Индивидуальные и групповые",right:!1}]},{question:"Первый этап процесса управления по целям – выработка ключевых результатов деятельности подразделения. Нормативное число ключевых результатов:",score:-1,status:"notanswered",type:"single",answers:[{label:"от 3 до 5",right:!1},{label:"от 6 до 8",right:!1},{label:"от 4 до 6",right:!0}]},{question:"Функция планирования отвечает на вопрос «ЧТО?», а функция организации – ...",score:-1,status:"notanswered",type:"multi",answers:[{label:"С какой целью?",right:!1},{label:"За что?",right:!1},{label:"Кто?",right:!0},{label:"Почему?",right:!1},{label:"Как?",right:!0},{label:"Когда?",right:!1}]},{question:"Закончите фразу: «Делегирование означает передачу прав и полномочий лицу, которое ...».",score:-1,status:"notanswered",type:"single",answers:[{label:"хочет их принять",right:!1},{label:"принимает на себя ответственность за их выполнение",right:!1},{label:"обязано их принять в силу должностных инструкций",right:!0}]}]}]}]};!function(){function t(t,e){t.state("page",{url:"/chapter/:chapter/page/:page",views:{header:{templateUrl:"js/components/header/headerTmpl.html",controller:"HeaderCtrl",controllerAs:"$ctrl"},content:{templateUrl:function(t){return"pages/"+(Number(t.chapter)>9?"chapter"+t.chapter:"chapter0"+t.chapter)+"/"+(Number(t.page)>9?"page"+t.page:"page0"+t.page)+"/index.html"},controller:"PageCtrl",controllerAs:"$ctrl"},footer:{templateUrl:"js/components/footer/footerTmpl.html",controller:"FooterCtrl",controllerAs:"$ctrl"}}})}function e(t,e,s,r){r.setAPIVersion("2004"),r.doLMSInitialize(),t.go("page",{chapter:1,page:1}),e.$on("$stateChangeStart",function(t,e,r,o){s.setBookmark(Number(r.page),Number(r.chapter))})}t.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$state","$rootScope","staticService","scormWrapper"],angular.module("courseApp",["ui.router","ngAnimate","vjs.video"]).constant("courseDataObj",courseStructure).constant("testDataObj",testStructure).constant("courseInfo",{bookmark:{page:0,chapterPage:0,chapter:0}}).config(t).run(e)}(),function(){function t(){var t="Auto",e=!1,s=["Auto","1.2","2004"];this.setAPIVersion=function(e){e=e||"Auto",console.log("set SCORM ver:",e);var r=s.indexOf(e.toString());return r>-1?t=s[r]:console.log("Not found, default to Auto"),t},this.getAPIVersion=function(){return t},this.isAvailable=function(){return!0},this.doLMSInitialize=function(){return this.cmiBooleanToJs(this.getAPICall("LMSInitialize","Initialize")(""))},this.doLMSFinish=function(){return this.cmiBooleanToJs(this.getAPICall("LMSFinish","Terminate")(""))},this.doLMSGetValue=function(t){return this.getAPICall("LMSGetValue","GetValue")(t)},this.doLMSSetValue=function(t,e){return this.cmiBooleanToJs(this.getAPICall("LMSSetValue","SetValue")(t,e))},this.doLMSCommit=function(){return this.cmiBooleanToJs(this.getAPICall("LMSCommit","Commit")(""))},this.doLMSGetLastError=function(){return this.getAPICall("LMSGetLastError","GetLastError")()},this.doLMSGetErrorString=function(t){return this.getAPICall("LMSGetErrorString","GetErrorString")(t.toString())},this.doLMSGetDiagnostic=function(t){return this.getAPICall("LMSGetDiagnostic","GetDiagnostic")(t.toString())},this.LMSIsInitialized=function(){return e},this.ErrorHandler=function(){return this.getAPICall("LMSGetLastError","GetLastError")()},this.cmiBooleanToJs=function(t){return"1"===t||1===t||"true"===t||!0===t},this.getAPIHandle=function(){var t=window;t.parent&&t.parent!=t&&this.findAPI(t.parent),!e&&t.top.opener?this.findAPI(t.top.opener):e||console.log("Unable to find API adapter")},this.findAPI=function(s){var r=0;for(r;r<500;r++){if(s.API&&("1.2"===t||"Auto"===t)){e=s.API,t="1.2";break}if(s.API_1484_11&&("2004"===t||"Auto"===t)){e=s.API_1484_11,t="2004";break}s.parent&&s.parent!=s&&(r++,s=s.parent)}},this.getAPICall=function(s,r){if(!e&&(this.getAPIHandle(),!e))return function(){console.log("No API found, can't execute: "+s+" or "+r)};switch(t){case"2004":return function(){return e[r].apply(e,arguments)};case"1.2":return function(){return e[s].apply(e,arguments)}}}}angular.module("courseApp").service("scormWrapper",t)}(),function(){function t(t,e){var s=this,r=[{type:"menu",state:!1},{type:"stats",state:!1},{type:"about",state:!1},{type:"help",state:!1},{type:"exercise",state:!1},{type:"video",state:!1},{type:"cloak",state:!1}];this.getModalState=function(t){return r[t].state},this.showModal=function(t){r[t].state?r[t].state=!1:(s.closeModals(),r[t].state=!0,r[r.length-1].state=!0)},this.closeModals=function(t){r.forEach(function(t){t.state=!1})},this.getCourseName=function(){return{course:t.course,description:t.description}},this.getChapterObj=function(e){return t.chapters[e]},this.getChaptersTotal=function(){return t.chapters},this.getPageTotal=function(){for(var e=0,s=0;s<t.chapters.length;s++)e+=t.chapters[s].pages.length;return e},this.getBookmark=function(){return e.bookmark},this.setBookmark=function(s,r){if(console.log("staticService:: setBookmark CP: %d, C: %d",s,r),e.bookmark.chapterPage=s-1,e.bookmark.chapter=r-1,1==r)e.bookmark.page=s-1;else{for(var o=0,i=0;i<r-1;i++)o+=t.chapters[i].pages.length;e.bookmark.page=o+s-1}},this.getData=function(e,s){return t.chapters[e.chapter-1].pages[e.page-1].data[s]},this.getMessage=function(e,s){return t.chapters[e.chapter-1].pages[e.page-1].messages[s]}}t.$inject=["courseDataObj","courseInfo"],angular.module("courseApp").service("staticService",t)}(),function(){function t(t,e,s,r){var o=this;t.chapters.map(function(t){return{id:t.id,visited:1,completed:!1,pages:t.pages.map(function(t,e){return{id:t.id,type:t.type,title:t.title,visited:0===e,completed:""}})}});this.exs=[],t.chapters.forEach(function(t,e,s){t.pages.map(function(t,s){"exercise"==t.type&&o.exs.push({id:t.id,chapterId:e,pageId:s,score:0,status:-1,title:t.title})})}),this.currentTestQuestion=null,this.setCurrentTestQuestion=function(t){o.currentTestQuestion=t},this.getExs=function(){return o.exs},this.getPageVisit=function(){},this.setPageVisit=function(t,e){},this.setUserProgress=function(t,e,s,r){o.exs.forEach(function(o,i,a){console.log("=>",o,s,r),o.chapterId==s&&o.pageId==r&&(o.score=t,o.status=e)}),console.log("userService:: setUserProgress > this.exs",o.exs)}}t.$inject=["courseDataObj","testDataObj","$document","scormWrapper"],angular.module("courseApp").service("userService",t)}(),function(){function t(t,e,s,r,o){var i=this;i.$onInit=function(){t({method:"GET",url:"img/svg-sprite.svg",cache:!0}).then(function(t){i.svgSprite=e.trustAsHtml(t.data)},function(t){console.log("error svg sprite didn't load...")})},i.showModal=function(t){return r.getModalState(t)},i.visitedPage=function(t){return o.getPageProgress(Number(t)-1).visited},i.completedPage=function(t){return o.getPageProgress(Number(t)-1).completed}}t.$inject=["$http","$sce","$stateParams","staticService","userService"],angular.module("courseApp").controller("CourseCtrl",t)}(),function(){function t(t,e,s){this.tabNum=1,s.getModalState=function(t){return e.getModalState(t)},s.closeModals=function(){return e.closeModals()}}t.$inject=["$document","staticService","$scope"],angular.module("courseApp").controller("PageCtrl",t)}(),function(){function t(t,e,s){var r=this;this.play="#play",this.mute="#unmute",this.volume=1,this.$onInit=function(){r.audio=t[0].createElement("audio"),r.audio.src="pages/chapter"+r.module+"/page"+r.page+"/audio/page-"+r.module+"-"+r.page+".mp3",r.audio.oncanplaythrough=function(){var t=this;this.changePlayPause=function(){this.audio.paused?(this.audio.play(),this.play="#pause"):(this.audio.pause(),this.play="#play")},this.updateSeekSlider=function(){var e=t.audio.currentTime*(100/t.audio.duration),s=Math.floor(t.audio.currentTime/60),r=Math.floor(t.audio.currentTime-60*s),o=Math.floor(t.audio.duration/60),i=Math.floor(t.audio.duration-60*o);t.seekPos=Math.floor(e),s<10&&(s="0"+s),r<10&&(r="0"+r),o<10&&(o="0"+o),i<10&&(i="0"+i),t.curTime=s+":"+r,t.durTime=o+":"+i,t.audio.currentTime===t.audio.duration&&(t.play="#play")},this.changeSeekPos=function(){t.audio.currentTime=t.audio.duration*(t.seekPos/100)},e(function(){if(t.audio)return t.updateSeekSlider(),s.setAudioTime(t.audio.currentTime),s.getStopAudio()?(t.audio.pause(),void(t.audio=null)):void 0},100),this.changeMuteState=function(){t.mute="#unmute",t.audio.muted?(t.audio.muted=!1,t.mute="#unmute"):(t.audio.muted=!0,t.mute="#mute")},this.changeVolume=function(){t.audio.volume=t.volume},this.restart=function(){t.audio.currentTime=0,t.audio.play(),t.play="#pause"}}}}t.$inject=["$document","$interval","staticService"],angular.module("courseApp").component("customAudio",{bindings:{module:"@",page:"@"},templateUrl:"js/components/custom-audio/customAudioTmpl.html",controller:"CustomAudioCtrl",controllerAs:"$ctrl"}).controller("CustomAudioCtrl",t)}(),function(){function t(t,e,s,r,o,i,a){var n=this;this.questionList=_.shuffle(JSON.parse(JSON.stringify(o.tests[0].groups[0].questions))),this.currentQuest=0,this.state=0,this.testTask=document.getElementsByClassName("test-task")[0],this.buildQuestion=function(){a.setCurrentTestQuestion(n.questionList[n.currentQuest]);n.testTask.append(s('<task-single-choice test="true"></task-single-choice>')(t)[0])},this.nextQuestion=function(t){t.target.classList.contains("btn_disabled")||(n.currentQuest++,n.currentQuest<n.questionList.length?(n.testTask.innerHTML="",n.buildQuestion()):(n.state=2,alert("konec")))},this.checkAnswer=function(){},this.removeRestart=function(){n.state=0,n.currentQuest=0,n.questionList=_.shuffle(JSON.parse(JSON.stringify(o.tests[0].groups[0].questions))),n.testTask.innerHTML="",n.buildQuestion()},angular.element(document).ready(function(){console.log(n.questionList);for(var t=(n.questionList[0].type,n.questionList[0].question,n.questionList[0].answers,0);t<n.questionList.length;t++);n.buildQuestion()})}t.$inject=["$scope","$state","$compile","$stateParams","testDataObj","staticService","userService"],angular.module("courseApp").component("finalTest",{templateUrl:"js/components/final-test/finalTestTmpl.html",controller:"TestCtrl",controllerAs:"$ctrl"}).controller("TestCtrl",t)}(),function(){function t(t,e,s,r){var o=this;this.bookmark=s.getBookmark(),this.coursePage=document.querySelector(".page-wrapper"),this.curChapterNum=Number(e.chapter),this.curPageNum=Number(e.page),this.pageAmountTotal=""+s.getPageTotal(),this.pageAmountChapter=s.getChapterObj(this.curChapterNum-1).pages.length,this.toBack=function(){1==o.curChapterNum&&1==o.curPageNum||(1==o.curPageNum?(o.curPageNum=s.getChapterObj(o.curChapterNum-2).pages.length,o.curChapterNum--):o.curPageNum--,s.setBookmark(o.curPageNum,o.curChapterNum),o.coursePage.classList.add("backward"),t.go("page",{chapter:o.curChapterNum,page:o.curPageNum}))},this.toForward=function(){o.curChapterNum==s.getChaptersTotal().length&&o.curPageNum==o.pageAmountChapter||(o.curPageNum==o.pageAmountChapter?(o.curChapterNum++,o.curPageNum=1):o.curPageNum++,s.setBookmark(o.curPageNum,o.curChapterNum),r.setPageVisit(o.curChapterNum-1,o.curPageNum),o.coursePage.classList.remove("backward"),t.go("page",{chapter:o.curChapterNum,page:o.curPageNum}))},this.toggleAbout=function(){},this.toggleHelp=function(){}}t.$inject=["$state","$stateParams","staticService","userService"],angular.module("courseApp").controller("FooterCtrl",t)}(),function(){function t(t,e,s,r){var o=this;this.chapters=s.getChaptersTotal(),this.exercises=r.exs,this.getExs=function(){return r.getExs()},this.countExs=function(){return r.getExs().length},this.countDoneExs=function(){var t=r.getExs(),e=0;return t.forEach(function(t,s,r){1==t.status&&e++}),e},this.title={course:s.getCourseName().course,chapter:s.getChapterObj(Number(e.chapter)-1).title,exercise:this.chapters[Number(e.chapter)-1].pages[Number(e.page)-1].title},this.getModalState=function(t){return s.getModalState(t)},this.menuPagesCounter=1,this.countPages=function(){return o.menuPagesCounter++},this.coursePage=document.querySelector(".page-wrapper"),this.goFromMenu=function(r,i){console.log("HeaderCtrl:: goFromMenu, page: %d, chapter: %d, SP: %s, SC: %s",r.id,i.id,e.page,e.chapter),i.id>Number(e.chapter)?o.coursePage.classList.remove("backward"):i.id==Number(e.chapter)&&r.id>Number(e.page)?o.coursePage.classList.remove("backward"):o.coursePage.classList.add("backward"),t.go("page",{chapter:i.id,page:r.id}),s.closeModals()},this.getCurrent=function(){return s.getBookmark().page+1},this.toggleMenu=function(){s.showModal(0)},this.toggleStat=function(){s.showModal(1)},this.toggleVideo=function(){s.showModal(6)}}t.$inject=["$state","$stateParams","staticService","userService"],angular.module("courseApp").controller("HeaderCtrl",t)}(),function(){function t(t,e,s){}t.$inject=["$element","$attrs","userService"],angular.module("courseApp").component("makeLine",{bindigs:{lineTo:"@"},controller:"LeaderLineCtrl"}).controller("LeaderLineCtrl",t)}(),function(){function t(t,e,s){var r=this;this.taskText=e.getData(t,"taskText"),e.getData(t,"shuffle")?this.questionList=_.shuffle(e.getData(t,"questionList")):this.questionList=e.getData(t,"questionList"),this.useVideo=e.getData(t,"useVideo"),this.videoPoster=e.getData(t,"videoPoster"),this.active=[],this.state=0,this.marker=-1,this.attemptNum=e.getData(t,"attempts"),this.userAttempt=0;for(var o=0;o<this.questionList.length;o++)this.active[o]={},this.active[o].selected=0,this.active[o].marker=-1;angular.element(document).ready(function(){r.useVideo&&(document.getElementsByClassName("btn_task-video")[0].style.background="url("+r.videoPoster+")"),r.selectMarker=function(t){r.marker=t},r.selectAnswer=function(t,e){-1!=r.marker&&2!=r.state&&(r.active[t].selected=1,r.active[t].marker=r.marker,e.currentTarget.setAttribute("data","marker"+r.marker),r.state=1)}}),this.checkAnswer=function(o){r.userAttempt===r.attemptNum&&(r.userAttempt=0),r.userAttempt++,r.state=2;for(var i=0;i<r.questionList.length;i++)if(r.questionList[i].rightAnswer!=r.active[i].marker)return 3===r.userAttempt&&console.log("taskSingleChoice:: attempt 3"),s.setUserProgress(0,0,Number(t.chapter)-1,Number(t.page)-1),void e.showModal(1,r.userAttempt,!1,Number(t.chapter)-1,Number(t.page)-1);console.log("taskSingleChoice:: упражнение верно"),s.setUserProgress(100,1,Number(t.chapter)-1,Number(t.page)-1),e.showModal(1,0,!0,Number(t.chapter)-1,Number(t.page)-1)},this.removeRestart=function(){for(var t=document.getElementsByClassName("task__marker-choice-item"),e=0;e<r.active.length;e++)r.active[e].selected=!1,r.active[e].marker=-1,t[e].setAttribute("data","");r.state=0,r.marker=-1,r.questionList=_.shuffle(r.questionList)},this.showVideo=function(){var s=document.querySelector(".modal_video");r.videoUrl=e.getData(t,"videoUrl"),console.warn("HeaderCtrl:: this.videoUrl:",r.videoUrl),r.videoPoster=e.getData(t,"videoPoster"),r.videoWidth=e.getData(t,"videoWidth"),r.videoHeight=e.getData(t,"videoHeight"),e.showModal(6);var o='<video class="video-js vjs-default-skin video-element" controls preload="auto"\n                               width="'+r.videoWidth+'" height="'+r.videoHeight+'" poster="'+r.videoPoster+'" vjs-video>\n                            <source src="'+r.videoUrl+'" type="video/mp4">\n                        </video>';s.innerHTML=o}}t.$inject=["$stateParams","staticService","userService"],angular.module("courseApp").component("taskMarkerChoice",{templateUrl:"js/components/task-marker-choice/taskMarkerChoiceTmpl.html",controller:"MarkerChoiceCtrl",controllerAs:"$ctrl"}).controller("MarkerChoiceCtrl",t)}(),function(){function t(t,e,s,r){var o=this;this.test=e.test,this.currentTestQuestion=r.currentTestQuestion,this.test?(console.log("SingleCCtrl:: test mode on"),this.taskText=this.currentTestQuestion.question,console.log("Question:",this.taskText),this.questionList=_.shuffle(this.currentTestQuestion.answers),console.log("Answers:",this.questionList)):(this.taskText=s.getData(t,"taskText"),this.questionList=_.shuffle(s.getData(t,"questionList"))),this.active=[],this.state=0,this.test?this.attemptNum=-1:this.attemptNum=s.getData(t,"attempts"),this.userAttempt=0;for(var i=0;i<this.questionList.length;i++)this.active[i]={},this.active[i].selected=0;this.showComment=!1,angular.element(document).ready(function(){o.selectAnswer=function(t){o.active.forEach(function(t){t.selected=0}),o.active[t].selected=1,o.state=1},o.checkAnswer=function(e){if(!e.target.classList.contains("btn_disabled")){o.userAttempt===o.attemptNum&&(o.userAttempt=0),o.userAttempt++,o.state=2;for(var i=0;i<o.questionList.length;i++)if(console.log("taskSingleChoice:: упражнение не верно"),o.questionList[i].right!==o.active[i].selected)return 3===o.userAttempt&&console.log("taskSingleChoice:: attempt 3"),r.setUserProgress(0,0,Number(t.chapter)-1,Number(t.page)-1),void s.showModal(1,o.userAttempt,!1,Number(t.chapter)-1,Number(t.page)-1);console.log("taskSingleChoice:: упражнение верно"),r.setUserProgress(100,1,Number(t.chapter)-1,Number(t.page)-1),s.showModal(1,0,!0,Number(t.chapter)-1,Number(t.page)-1)}},o.removeRestart=function(){for(var t=0;t<o.active.length;t++)o.active[t].selected=!1;o.state=0,o.questionList=_.shuffle(o.questionList)}})}t.$inject=["$stateParams","$attrs","staticService","userService"],angular.module("courseApp").component("taskSingleChoice",{templateUrl:"js/components/task-single-choice/taskSingleChoiceTmpl.html",controller:"SingleChoiceCtrl",controllerAs:"$ctrl"}).controller("SingleChoiceCtrl",t)}(),function(){function t(){angular.element(document).ready(function(){function t(t,e){if(t.classList.contains("task-swap-list_item__fixed"))return void console.warn("drop on fixed");var s=t.parentNode,r=t.nextSibling===e?t:t.nextSibling;e.parentNode.insertBefore(t,e),s.insertBefore(e,r),e.style.left="0px",e.style.top="0px"}$(function(){$(".task-swap-list_item").draggable({zIndex:2,start:function(t,e){},stop:function(t,e){console.log(e),e.helper[0].style.top="0px",e.helper[0].style.left="0px"}}).droppable({drop:function(e,s){console.log("куда =>",$(this).get(0)),console.log("что =>",$(s.draggable).get(0)),t($(this).get(0),$(s.draggable).get(0))}})})})}angular.module("courseApp").component("taskSwapList",{templateUrl:"js/components/task-swap-list/taskSwapListTmpl.html",controller:"SwapListCtrl",controllerAs:"$ctrl"}).controller("SwapListCtrl",t)}();