"use strict";var courseStructure={course:"Легко ли быть менеджером?",description:"Модульный курс для дистанционного обучения",chapters:[{id:1,title:"Глава 1",pages:[{id:1,title:"Page 1",location:"page01",type:"simple_page",messages:[""]},{id:2,title:"Page 2",location:"page02",type:"simple_page",messages:[""]}]},{id:2,title:"Глава 2",pages:[{id:1,title:"Page01 in ch 2",location:"page01",type:"simple_page",messages:[""]},{id:2,title:"Упражнение №2",location:"page03",type:"exercise",data:{attempts:-1,shuffle:!0,showAnswer:!1,useVideo:!0,videoUrl:"video.svg",taskText:"Посмотрите киноэпизод. Прокомментируйте высказывания героя фильма. Раскрасте в зелёный цвет ты высказывания, с которыми согласны, а в красный те, с которыми не согласны.",questionList:[{question:"Мотивировать - это дело руководства: пусть зарплату повышают.",rightAnswer:0},{question:"МотивОрганизовывать... тоже никого не надо, все знают, что им делать.",rightAnswer:1},{question:"А вот контролировать - это нужно.",rightAnswer:0},{question:"Надо наказывать почаще, а то избаловались, всё на начальство сваливают.",rightAnswer:1},{question:"Правильный вариант для ассортимента.",rightAnswer:1}]},messages:["Правильный ответ!","Ответ неверный!"]}]}]};!function(){function e(e,t){e.state("page",{url:"/chapter/:chapter/page/:page",views:{header:{templateUrl:"js/components/header/headerTmpl.html",controller:"HeaderCtrl",controllerAs:"$ctrl"},content:{templateUrl:function(e){return"pages/"+(Number(e.chapter)>9?"chapter"+e.chapter:"chapter0"+e.chapter)+"/"+(Number(e.page)>9?"page"+e.page:"page0"+e.page)+"/index.html"},controller:"PageCtrl",controllerAs:"$ctrl"},footer:{templateUrl:"js/components/footer/footerTmpl.html",controller:"FooterCtrl",controllerAs:"$ctrl"}}})}function t(e,t,r){e.go("page",{chapter:1,page:1}),t.$on("$stateChangeStart",function(e,t,a,s){r.setBookmark(Number(a.page),Number(a.chapter))})}e.$inject=["$stateProvider","$urlRouterProvider"],t.$inject=["$state","$rootScope","staticService"],angular.module("courseApp",["ui.router","ngAnimate"]).constant("courseDataObj",courseStructure).constant("courseInfo",{bookmark:{page:0,chapterPage:0,chapter:0}}).config(e).run(t)}(),function(){function e(e,t){var r=this,a=[{type:"menu",state:!1},{type:"stats",state:!1},{type:"about",state:!1},{type:"help",state:!1},{type:"exercise",state:!1},{type:"cloak",state:!1}];this.getModalState=function(e){return a[e].state},this.showModal=function(e){a[e].state?a[e].state=!1:(r.closeModals(),a[e].state=!0,a[a.length-1].state=!0)},this.closeModals=function(e){a.forEach(function(e){e.state=!1})},this.getCourseName=function(){return{course:e.course,description:e.description}},this.getChapterObj=function(t){return e.chapters[t]},this.getChaptersTotal=function(){return e.chapters},this.getPageTotal=function(){for(var t=0,r=0;r<e.chapters.length;r++)t+=e.chapters[r].pages.length;return t},this.getBookmark=function(){return t.bookmark},this.setBookmark=function(r,a){if(console.log("staticService:: setBookmark CP: %d, C: %d",r,a),t.bookmark.chapterPage=r-1,t.bookmark.chapter=a-1,1==a)t.bookmark.page=r-1;else{for(var s=0,o=0;o<a-1;o++)s+=e.chapters[o].pages.length;t.bookmark.page=s+r-1}},this.getData=function(t,r){return e.chapters[t.chapter-1].pages[t.page-1].data[r]},this.getMessage=function(t,r){return e.chapters[t.chapter-1].pages[t.page-1].messages[r]}}e.$inject=["courseDataObj","courseInfo"],angular.module("courseApp").service("staticService",e)}(),function(){function e(e,t){var r=this;e.chapters.map(function(e){return{id:e.id,visited:1,completed:!1,pages:e.pages.map(function(e,t){return{id:e.id,type:e.type,title:e.title,visited:0===t,completed:""}})}});this.exs=[],e.chapters.forEach(function(e,t,a){e.pages.map(function(e,a){"exercise"==e.type&&r.exs.push({id:e.id,chapterId:t,pageId:a,score:0,status:-1,title:e.title})})}),this.getExs=function(){return console.log("userService:: getExs, exs",r.exs),r.exs},this.getPageVisit=function(){},this.setPageVisit=function(e,t){},this.setUserProgress=function(e,t,a,s){r.exs.forEach(function(r,o,i){console.log("=>",r,a,s),r.chapterId==a&&r.pageId==s&&(r.score=e,r.status=t)}),console.log("userService:: setUserProgress > this.exs",r.exs)}}e.$inject=["courseDataObj","$document"],angular.module("courseApp").service("userService",e)}(),function(){function e(e,t,r,a,s){var o=this;o.$onInit=function(){e({method:"GET",url:"img/svg-sprite.svg",cache:!0}).then(function(e){o.svgSprite=t.trustAsHtml(e.data)},function(e){console.log("error svg sprite didn't load...")})},o.showModal=function(e){return a.getModalState(e)},o.visitedPage=function(e){return s.getPageProgress(Number(e)-1).visited},o.completedPage=function(e){return s.getPageProgress(Number(e)-1).completed}}e.$inject=["$http","$sce","$stateParams","staticService","userService"],angular.module("courseApp").controller("CourseCtrl",e)}(),function(){function e(e,t,r){this.tabNum=1,r.getModalState=function(e){return t.getModalState(e)},r.closeModals=function(){return t.closeModals()}}e.$inject=["$document","staticService","$scope"],angular.module("courseApp").controller("PageCtrl",e)}(),function(){function e(e,t,r){var a=this;this.play="#play",this.mute="#unmute",this.volume=1,this.$onInit=function(){a.audio=e[0].createElement("audio"),a.audio.src="pages/chapter"+a.module+"/page"+a.page+"/audio/page-"+a.module+"-"+a.page+".mp3",a.audio.oncanplaythrough=function(){var e=this;this.changePlayPause=function(){this.audio.paused?(this.audio.play(),this.play="#pause"):(this.audio.pause(),this.play="#play")},this.updateSeekSlider=function(){var t=e.audio.currentTime*(100/e.audio.duration),r=Math.floor(e.audio.currentTime/60),a=Math.floor(e.audio.currentTime-60*r),s=Math.floor(e.audio.duration/60),o=Math.floor(e.audio.duration-60*s);e.seekPos=Math.floor(t),r<10&&(r="0"+r),a<10&&(a="0"+a),s<10&&(s="0"+s),o<10&&(o="0"+o),e.curTime=r+":"+a,e.durTime=s+":"+o,e.audio.currentTime===e.audio.duration&&(e.play="#play")},this.changeSeekPos=function(){e.audio.currentTime=e.audio.duration*(e.seekPos/100)},t(function(){if(e.audio)return e.updateSeekSlider(),r.setAudioTime(e.audio.currentTime),r.getStopAudio()?(e.audio.pause(),void(e.audio=null)):void 0},100),this.changeMuteState=function(){e.mute="#unmute",e.audio.muted?(e.audio.muted=!1,e.mute="#unmute"):(e.audio.muted=!0,e.mute="#mute")},this.changeVolume=function(){e.audio.volume=e.volume},this.restart=function(){e.audio.currentTime=0,e.audio.play(),e.play="#pause"}}}}e.$inject=["$document","$interval","staticService"],angular.module("courseApp").component("customAudio",{bindings:{module:"@",page:"@"},templateUrl:"js/components/custom-audio/customAudioTmpl.html",controller:"CustomAudioCtrl",controllerAs:"$ctrl"}).controller("CustomAudioCtrl",e)}(),function(){function e(e,t,r,a){var s=this;this.bookmark=r.getBookmark(),this.coursePage=document.querySelector(".page-wrapper"),this.curChapterNum=Number(t.chapter),this.curPageNum=Number(t.page),this.pageAmountTotal=""+r.getPageTotal(),this.pageAmountChapter=r.getChapterObj(this.curChapterNum-1).pages.length,this.toBack=function(){1==s.curChapterNum&&1==s.curPageNum||(1==s.curPageNum?(s.curPageNum=r.getChapterObj(s.curChapterNum-2).pages.length,s.curChapterNum--):s.curPageNum--,r.setBookmark(s.curPageNum,s.curChapterNum),s.coursePage.classList.add("backward"),e.go("page",{chapter:s.curChapterNum,page:s.curPageNum}))},this.toForward=function(){s.curChapterNum==r.getChaptersTotal().length&&s.curPageNum==s.pageAmountChapter||(s.curPageNum==s.pageAmountChapter?(s.curChapterNum++,s.curPageNum=1):s.curPageNum++,r.setBookmark(s.curPageNum,s.curChapterNum),a.setPageVisit(s.curChapterNum-1,s.curPageNum),s.coursePage.classList.remove("backward"),e.go("page",{chapter:s.curChapterNum,page:s.curPageNum}))},this.toggleAbout=function(){},this.toggleHelp=function(){}}e.$inject=["$state","$stateParams","staticService","userService"],angular.module("courseApp").controller("FooterCtrl",e)}(),function(){function e(e,t,r,a){var s=this;this.chapters=r.getChaptersTotal(),this.exercises=a.exs,this.getExs=function(){return a.getExs()},this.countExs=function(){return a.getExs().length},this.countDoneExs=function(){var e=a.getExs(),t=0;return e.forEach(function(e,r,a){1==e.status&&t++}),t},this.title={course:r.getCourseName().course,chapter:r.getChapterObj(Number(t.chapter)-1).title,exercise:this.chapters[Number(t.chapter)-1].pages[Number(t.page)-1].title},this.getModalState=function(e){return r.getModalState(e)},this.menuPagesCounter=1,this.countPages=function(){return s.menuPagesCounter++},this.coursePage=document.querySelector(".page-wrapper"),this.goFromMenu=function(a,o){console.log("HeaderCtrl:: goFromMenu, page: %d, chapter: %d, SP: %s, SC: %s",a.id,o.id,t.page,t.chapter),o.id>Number(t.chapter)?s.coursePage.classList.remove("backward"):o.id==Number(t.chapter)&&a.id>Number(t.page)?s.coursePage.classList.remove("backward"):s.coursePage.classList.add("backward"),e.go("page",{chapter:o.id,page:a.id}),r.closeModals()},this.getCurrent=function(){return r.getBookmark().page+1},this.toggleMenu=function(){r.showModal(0)},this.toggleStat=function(){r.showModal(1)}}e.$inject=["$state","$stateParams","staticService","userService"],angular.module("courseApp").controller("HeaderCtrl",e)}(),function(){function e(e,t,r){}e.$inject=["$element","$attrs","userService"],angular.module("courseApp").component("makeLine",{bindigs:{lineTo:"@"},controller:"LeaderLineCtrl"}).controller("LeaderLineCtrl",e)}(),function(){function e(e,t,r){var a=this;this.taskText=t.getData(e,"taskText"),t.getData(e,"shuffle")?this.questionList=_.shuffle(t.getData(e,"questionList")):this.questionList=t.getData(e,"questionList"),this.useVideo=t.getData(e,"useVideo"),this.active=[],this.state=0,this.marker=-1,this.attemptNum=t.getData(e,"attempts"),this.userAttempt=0;for(var s=0;s<this.questionList.length;s++)this.active[s]={},this.active[s].selected=0,this.active[s].marker=-1;angular.element(document).ready(function(){a.useVideo&&(document.getElementsByClassName("btn_task-video")[0].style.background="url(img/"+t.getData(e,"videoUrl")+")"),a.selectMarker=function(e){a.marker=e},a.selectAnswer=function(e,t){-1!=a.marker&&2!=a.state&&(a.active[e].selected=1,a.active[e].marker=a.marker,t.currentTarget.setAttribute("data","marker"+a.marker),a.state=1)}}),this.checkAnswer=function(s){a.userAttempt===a.attemptNum&&(a.userAttempt=0),a.userAttempt++,a.state=2;for(var o=0;o<a.questionList.length;o++)if(a.questionList[o].rightAnswer!=a.active[o].marker)return 3===a.userAttempt&&console.log("taskSingleChoice:: attempt 3"),r.setUserProgress(0,0,Number(e.chapter)-1,Number(e.page)-1),void t.showModal(1,a.userAttempt,!1,Number(e.chapter)-1,Number(e.page)-1);console.log("taskSingleChoice:: упражнение верно"),r.setUserProgress(100,1,Number(e.chapter)-1,Number(e.page)-1),t.showModal(1,0,!0,Number(e.chapter)-1,Number(e.page)-1)},this.removeRestart=function(){for(var e=document.getElementsByClassName("task__marker-choice-item"),t=0;t<a.active.length;t++)a.active[t].selected=!1,a.active[t].marker=-1,e[t].setAttribute("data","");a.state=0,a.marker=-1,a.questionList=_.shuffle(a.questionList)}}e.$inject=["$stateParams","staticService","userService"],angular.module("courseApp").component("taskMarkerChoice",{templateUrl:"js/components/task-marker-choice/taskMarkerChoiceTmpl.html",controller:"MarkerChoiceCtrl",controllerAs:"$ctrl"}).controller("MarkerChoiceCtrl",e)}(),function(){function e(e,t,r){var a=this;this.taskText=t.getData(e,"taskText"),this.questionList=_.shuffle(t.getData(e,"questionList")),this.active=[],this.state=0,this.attemptNum=t.getData(e,"attempts"),this.userAttempt=0;for(var s=0;s<this.questionList.length;s++)this.active[s]={},this.active[s].selected=0;this.showComment=!1,angular.element(document).ready(function(){a.selectAnswer=function(e){a.active.forEach(function(e){e.selected=0}),a.active[e].selected=1,a.state=1},a.checkAnswer=function(s){if(!s.target.classList.contains("btn_disabled")){a.userAttempt===a.attemptNum&&(a.userAttempt=0),a.userAttempt++,a.state=2;for(var o=0;o<a.questionList.length;o++)if(console.log("taskSingleChoice:: упражнение не верно"),a.questionList[o].rightAnswer!==a.active[o].selected)return 3===a.userAttempt&&console.log("taskSingleChoice:: attempt 3"),r.setUserProgress(0,0,Number(e.chapter)-1,Number(e.page)-1),void t.showModal(1,a.userAttempt,!1,Number(e.chapter)-1,Number(e.page)-1);console.log("taskSingleChoice:: упражнение верно"),r.setUserProgress(100,1,Number(e.chapter)-1,Number(e.page)-1),t.showModal(1,0,!0,Number(e.chapter)-1,Number(e.page)-1)}},a.removeRestart=function(){for(var e=0;e<a.active.length;e++)a.active[e].selected=!1;a.state=0,a.questionList=_.shuffle(a.questionList)}})}e.$inject=["$stateParams","staticService","userService"],angular.module("courseApp").component("taskSingleChoice",{bindings:{shuffle:"@",lastAttempt:"@",showAnswer:"@"},templateUrl:"js/components/task-single-choice/taskSingleChoiceTmpl.html",controller:"SingleChoiceCtrl",controllerAs:"$ctrl"}).controller("SingleChoiceCtrl",e)}();